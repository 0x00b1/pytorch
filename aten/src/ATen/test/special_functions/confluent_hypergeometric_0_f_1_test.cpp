#include <gtest/gtest.h>
#include <ATen/native/special_functions/confluent_hypergeometric_0_f_1.h>

template<typename T1>
struct confluent_hypergeometric_0_f_1_fixture {
  T1 f0;
  T1 c;
  T1 x;
  T1 f;
};

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0001[21] = {
    {0.22884381861489375, 1.0000000000000000, -10.000000000000000, 0.0},
    {0.15064525725099692, 1.0000000000000000, -9.0000000000000000, 0.0},
    {0.045829664859813955, 1.0000000000000000, -8.0000000000000000, 0.0},
    {-0.078742457116226891, 1.0000000000000000, -7.0000000000000000, 0.0},
    {-0.21005940220737079, 1.0000000000000000, -6.0000000000000000, 0.0},
    {-0.32687528182353381, 1.0000000000000000, -5.0000000000000000, 0.0},
    {-0.39714980986384740, 1.0000000000000000, -4.0000000000000000, 0.0},
    {-0.37492595624330988, 1.0000000000000000, -3.0000000000000000, 0.0},
    {-0.19654809527046838, 1.0000000000000000, -2.0000000000000000, 0.0},
    {0.22389077914123562, 1.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 1.0000000000000000, 0.0000000000000000, 0.0},
    {2.2795853023360668, 1.0000000000000000, 1.0000000000000000, 0.0},
    {4.2523508795026252, 1.0000000000000000, 2.0000000000000000, 0.0},
    {7.1589965368043815, 1.0000000000000000, 3.0000000000000000, 0.0},
    {11.301921952136325, 1.0000000000000000, 4.0000000000000000, 0.0},
    {17.057777853369053, 1.0000000000000000, 5.0000000000000000, 0.0},
    {24.892134931406616, 1.0000000000000000, 6.0000000000000000, 0.0},
    {35.376575857256881, 1.0000000000000000, 7.0000000000000000, 0.0},
    {49.208554223075545, 1.0000000000000000, 8.0000000000000000, 0.0},
    {67.234406976477970, 1.0000000000000000, 9.0000000000000000, 0.0},
    {90.475954396327623, 1.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0001 = 5.0000000000000039e-13;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0002[21] = {
    {-0.063793231419410068, 2.0000000000000000, -10.000000000000000, 0.0},
    {-0.092227952709188488, 2.0000000000000000, -9.0000000000000000, 0.0},
    {-0.11628765591198210, 2.0000000000000000, -8.0000000000000000, 0.0},
    {-0.13072251130715146, 2.0000000000000000, -7.0000000000000000, 0.0},
    {-0.12841286613454994, 2.0000000000000000, -6.0000000000000000, 0.0},
    {-0.099930653302113231, 2.0000000000000000, -5.0000000000000000, 0.0},
    {-0.033021664011774615, 2.0000000000000000, -4.0000000000000000, 0.0},
    {0.088003064612533224, 2.0000000000000000, -3.0000000000000000, 0.0},
    {0.28297998688054243, 2.0000000000000000, -2.0000000000000000, 0.0},
    {0.57672480775687363, 2.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 2.0000000000000000, 0.0000000000000000, 0.0},
    {1.5906368546373291, 2.0000000000000000, 1.0000000000000000, 0.0},
    {2.3948330992734057, 2.0000000000000000, 2.0000000000000000, 0.0},
    {3.4686496187605331, 2.0000000000000000, 3.0000000000000000, 0.0},
    {4.8797325768522244, 2.0000000000000000, 4.0000000000000000, 0.0},
    {6.7092902907288696, 2.0000000000000000, 5.0000000000000000, 0.0},
    {9.0543575800259291, 2.0000000000000000, 6.0000000000000000, 0.0},
    {12.030384027849351, 2.0000000000000000, 7.0000000000000000, 0.0},
    {15.774186685405725, 2.0000000000000000, 8.0000000000000000, 0.0},
    {20.447312259213405, 2.0000000000000000, 9.0000000000000000, 0.0},
    {26.239858778249044, 2.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0002 = 2.5000000000000020e-13;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0003[21] = {
    {-0.058527410006860806, 3.0000000000000000, -10.000000000000000, 0.0},
    {-0.053971824435596803, 3.0000000000000000, -9.0000000000000000, 0.0},
    {-0.040529330192949048, 3.0000000000000000, -8.0000000000000000, 0.0},
    {-0.014851444054549919, 3.0000000000000000, -7.0000000000000000, 0.0},
    {0.027215512024273508, 3.0000000000000000, -6.0000000000000000, 0.0},
    {0.090777851408568283, 3.0000000000000000, -5.0000000000000000, 0.0},
    {0.18206407292603666, 3.0000000000000000, -4.0000000000000000, 0.0},
    {0.30861934723722911, 3.0000000000000000, -3.0000000000000000, 0.0},
    {0.47952808215101128, 3.0000000000000000, -2.0000000000000000, 0.0},
    {0.70566805723127612, 3.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 3.0000000000000000, 0.0000000000000000, 0.0},
    {1.3778968953974779, 3.0000000000000000, 1.0000000000000000, 0.0},
    {1.8575177802292218, 3.0000000000000000, 2.0000000000000000, 0.0},
    {2.4602312786959031, 3.0000000000000000, 3.0000000000000000, 0.0},
    {3.2110946876420559, 3.0000000000000000, 4.0000000000000000, 0.0},
    {4.1393950250560820, 3.0000000000000000, 5.0000000000000000, 0.0},
    {5.2792591171269008, 3.0000000000000000, 6.0000000000000000, 0.0},
    {6.6703405226878729, 3.0000000000000000, 7.0000000000000000, 0.0},
    {8.3585918844174660, 3.0000000000000000, 8.0000000000000000, 0.0},
    {10.397132159392129, 3.0000000000000000, 9.0000000000000000, 0.0},
    {12.847219123615725, 3.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0003 = 5.0000000000000039e-13;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0004[21] = {
    {0.0031594928475296006, 4.0000000000000000, -10.000000000000000, 0.0},
    {0.025504085515727862, 4.0000000000000000, -9.0000000000000000, 0.0},
    {0.056818744289275018, 4.0000000000000000, -8.0000000000000000, 0.0},
    {0.099318057645087318, 4.0000000000000000, -7.0000000000000000, 0.0},
    {0.15562837815882385, 4.0000000000000000, -6.0000000000000000, 0.0},
    {0.22885020565281822, 4.0000000000000000, -5.0000000000000000, 0.0},
    {0.32262860540671723, 4.0000000000000000, -4.0000000000000000, 0.0},
    {0.44123256524939214, 4.0000000000000000, -3.0000000000000000, 0.0},
    {0.58964428581140604, 4.0000000000000000, -2.0000000000000000, 0.0},
    {0.77365949684641400, 4.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 4.0000000000000000, 0.0000000000000000, 0.0},
    {1.2764397554391185, 4.0000000000000000, 1.0000000000000000, 0.0},
    {1.6119459571325614, 4.0000000000000000, 2.0000000000000000, 0.0},
    {2.0168366801292668, 4.0000000000000000, 3.0000000000000000, 0.0},
    {2.5029568338152637, 4.0000000000000000, 4.0000000000000000, 0.0},
    {3.0838743188073603, 4.0000000000000000, 5.0000000000000000, 0.0},
    {3.7750984628990416, 4.0000000000000000, 6.0000000000000000, 0.0},
    {4.5943230044241439, 4.0000000000000000, 7.0000000000000000, 0.0},
    {5.5616961007412149, 4.0000000000000000, 8.0000000000000000, 0.0},
    {6.7001200665475382, 4.0000000000000000, 9.0000000000000000, 0.0},
    {8.0355837927800149, 4.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0004 = 2.5000000000000015e-12;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0005[21] = {
    {0.074024283425268345, 5.0000000000000000, -10.000000000000000, 0.0},
    {0.10596787993509940, 5.0000000000000000, -9.0000000000000000, 0.0},
    {0.14602211172333579, 5.0000000000000000, -8.0000000000000000, 0.0},
    {0.19571914577080615, 5.0000000000000000, -7.0000000000000000, 0.0},
    {0.25682573226909988, 5.0000000000000000, -6.0000000000000000, 0.0},
    {0.33137365018619869, 5.0000000000000000, -5.0000000000000000, 0.0},
    {0.42169359744203999, 5.0000000000000000, -4.0000000000000000, 0.0},
    {0.53045287204864944, 5.0000000000000000, -3.0000000000000000, 0.0},
    {0.66069722196236347, 5.0000000000000000, -2.0000000000000000, 0.0},
    {0.81589727538164203, 5.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 5.0000000000000000, 0.0000000000000000, 0.0},
    {1.2174856795003253, 5.0000000000000000, 1.0000000000000000, 0.0},
    {1.4734309385799740, 5.0000000000000000, 2.0000000000000000, 0.0},
    {1.7735783942665484, 5.0000000000000000, 3.0000000000000000, 0.0},
    {2.1244135614803832, 5.0000000000000000, 4.0000000000000000, 0.0},
    {2.5332496949969392, 5.0000000000000000, 5.0000000000000000, 0.0},
    {3.0083213084557183, 5.0000000000000000, 6.0000000000000000, 0.0},
    {3.5588871741663994, 5.0000000000000000, 7.0000000000000000, 0.0},
    {4.1953436755143798, 5.0000000000000000, 8.0000000000000000, 0.0},
    {4.9293494571261318, 5.0000000000000000, 9.0000000000000000, 0.0},
    {5.7739623970028591, 5.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0005 = 2.5000000000000020e-13;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0006[21] = {
    {0.14172958115547787, 6.0000000000000000, -10.000000000000000, 0.0},
    {0.17880843204304850, 6.0000000000000000, -9.0000000000000000, 0.0},
    {0.22300841858515275, 6.0000000000000000, -8.0000000000000000, 0.0},
    {0.27543168035919829, 6.0000000000000000, -7.0000000000000000, 0.0},
    {0.33732451370092226, 6.0000000000000000, -6.0000000000000000, 0.0},
    {0.41009377813352499, 6.0000000000000000, -5.0000000000000000, 0.0},
    {0.49532496017661976, 6.0000000000000000, -4.0000000000000000, 0.0},
    {0.59480204532839187, 6.0000000000000000, -3.0000000000000000, 0.0},
    {0.71052936150958945, 6.0000000000000000, -2.0000000000000000, 0.0},
    {0.84475557070460416, 6.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 6.0000000000000000, 0.0000000000000000, 0.0},
    {1.1790815187758072, 6.0000000000000000, 1.0000000000000000, 0.0},
    {1.3851501855258348, 6.0000000000000000, 2.0000000000000000, 0.0},
    {1.6217219057514245, 6.0000000000000000, 3.0000000000000000, 0.0},
    {1.8927163616743783, 6.0000000000000000, 4.0000000000000000, 0.0},
    {2.2024984952416649, 6.0000000000000000, 5.0000000000000000, 0.0},
    {2.5559238481443916, 6.0000000000000000, 6.0000000000000000, 0.0},
    {2.9583880864506735, 6.0000000000000000, 7.0000000000000000, 0.0},
    {3.4158810630670575, 6.0000000000000000, 8.0000000000000000, 0.0},
    {3.9350457987142105, 6.0000000000000000, 9.0000000000000000, 0.0},
    {4.5232427915542850, 6.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0006 = 2.5000000000000020e-13;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0007[21] = {
    {0.20311589319062762, 7.0000000000000000, -10.000000000000000, 0.0},
    {0.24280184035982888, 7.0000000000000000, -9.0000000000000000, 0.0},
    {0.28869865073181245, 7.0000000000000000, -8.0000000000000000, 0.0},
    {0.34162514823596285, 7.0000000000000000, -7.0000000000000000, 0.0},
    {0.40249390715910782, 7.0000000000000000, -6.0000000000000000, 0.0},
    {0.47232076768395193, 7.0000000000000000, -5.0000000000000000, 0.0},
    {0.55223522050933826, 7.0000000000000000, -4.0000000000000000, 0.0},
    {0.64349173279741045, 7.0000000000000000, -3.0000000000000000, 0.0},
    {0.74748209320836823, 7.0000000000000000, -2.0000000000000000, 0.0},
    {0.86574885968879600, 7.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 7.0000000000000000, 0.0000000000000000, 0.0},
    {1.1521248217356443, 7.0000000000000000, 1.0000000000000000, 0.0},
    {1.3242112958121424, 7.0000000000000000, 2.0000000000000000, 0.0},
    {1.5185648851512930, 7.0000000000000000, 3.0000000000000000, 0.0},
    {1.7377289985450737, 7.0000000000000000, 4.0000000000000000, 0.0},
    {1.9845071985316807, 7.0000000000000000, 5.0000000000000000, 0.0},
    {2.2619873015566716, 7.0000000000000000, 6.0000000000000000, 0.0},
    {2.5735675187817293, 7.0000000000000000, 7.0000000000000000, 0.0},
    {2.9229847966775000, 7.0000000000000000, 8.0000000000000000, 0.0},
    {3.3143455280397682, 7.0000000000000000, 9.0000000000000000, 0.0},
    {3.7521588163457444, 7.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0007 = 2.5000000000000020e-13;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0008[21] = {
    {0.25782251054763078, 8.0000000000000000, -10.000000000000000, 0.0},
    {0.29863590547831054, 8.0000000000000000, -9.0000000000000000, 0.0},
    {0.34487371876996442, 8.0000000000000000, -8.0000000000000000, 0.0},
    {0.39716080726059139, 8.0000000000000000, -7.0000000000000000, 0.0},
    {0.45618575420730401, 8.0000000000000000, -6.0000000000000000, 0.0},
    {0.52270671222358922, 8.0000000000000000, -5.0000000000000000, 0.0},
    {0.59755773349355401, 8.0000000000000000, -4.0000000000000000, 0.0},
    {0.68165562456626705, 8.0000000000000000, -3.0000000000000000, 0.0},
    {0.77600736567436179, 8.0000000000000000, -2.0000000000000000, 0.0},
    {0.88171813733610527, 8.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 8.0000000000000000, 0.0000000000000000, 0.0},
    {1.1321812756867706, 8.0000000000000000, 1.0000000000000000, 0.0},
    {1.2797166839875371, 8.0000000000000000, 2.0000000000000000, 0.0},
    {1.4441982884018127, 8.0000000000000000, 3.0000000000000000, 0.0},
    {1.6273673128576827, 8.0000000000000000, 4.0000000000000000, 0.0},
    {1.8311268923638555, 8.0000000000000000, 5.0000000000000000, 0.0},
    {2.0575558261140210, 8.0000000000000000, 6.0000000000000000, 0.0},
    {2.3089234060136383, 8.0000000000000000, 7.0000000000000000, 0.0},
    {2.5877053985451806, 8.0000000000000000, 8.0000000000000000, 0.0},
    {2.8966012631473927, 8.0000000000000000, 9.0000000000000000, 0.0},
    {3.2385526958758675, 8.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0008 = 5.0000000000000039e-13;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0009[21] = {
    {0.30635705719921286, 9.0000000000000000, -10.000000000000000, 0.0},
    {0.34741196073721431, 9.0000000000000000, -9.0000000000000000, 0.0},
    {0.39322547626705723, 9.0000000000000000, -8.0000000000000000, 0.0},
    {0.44428527219701841, 9.0000000000000000, -7.0000000000000000, 0.0},
    {0.50112390578315280, 9.0000000000000000, -6.0000000000000000, 0.0},
    {0.56432257884392711, 9.0000000000000000, -5.0000000000000000, 0.0},
    {0.63451518177899469, 9.0000000000000000, -4.0000000000000000, 0.0},
    {0.71239264635196675, 9.0000000000000000, -3.0000000000000000, 0.0},
    {0.79870762904775072, 9.0000000000000000, -2.0000000000000000, 0.0},
    {0.89427954824917422, 9.0000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 9.0000000000000000, 0.0000000000000000, 0.0},
    {1.1168385787371085, 9.0000000000000000, 1.0000000000000000, 0.0},
    {1.2458491310890449, 9.0000000000000000, 2.0000000000000000, 0.0},
    {1.3881764726570229, 9.0000000000000000, 3.0000000000000000, 0.0},
    {1.5450635996235385, 9.0000000000000000, 4.0000000000000000, 0.0},
    {1.7178594290796858, 9.0000000000000000, 5.0000000000000000, 0.0},
    {1.9080271041314578, 9.0000000000000000, 6.0000000000000000, 0.0},
    {2.1171529021447926, 9.0000000000000000, 7.0000000000000000, 0.0},
    {2.3469557869262827, 9.0000000000000000, 8.0000000000000000, 0.0},
    {2.5992976482192822, 9.0000000000000000, 9.0000000000000000, 0.0},
    {2.8761942746313820, 9.0000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0009 = 2.5000000000000020e-13;

const confluent_hypergeometric_0_f_1_fixture<double> fixture_0010[21] = {
    {0.34944873589139591, 10.000000000000000, -10.000000000000000, 0.0},
    {0.39020844207123617, 10.000000000000000, -9.0000000000000000, 0.0},
    {0.43516581747384225, 10.000000000000000, -8.0000000000000000, 0.0},
    {0.48470878220325925, 10.000000000000000, -7.0000000000000000, 0.0},
    {0.53925781891019697, 10.000000000000000, -6.0000000000000000, 0.0},
    {0.59926847933287575, 10.000000000000000, -5.0000000000000000, 0.0},
    {0.66523406913795291, 10.000000000000000, -4.0000000000000000, 0.0},
    {0.73768852285681563, 10.000000000000000, -3.0000000000000000, 0.0},
    {0.81720948144207683, 10.000000000000000, -2.0000000000000000, 0.0},
    {0.90442158574109210, 10.000000000000000, -1.0000000000000000, 0.0},
    {1.0000000000000000, 10.000000000000000, 0.0000000000000000, 0.0},
    {1.1046741803755711, 10.000000000000000, 1.0000000000000000, 0.0},
    {1.2192319043456152, 10.000000000000000, 2.0000000000000000, 0.0},
    {1.3445235778749209, 10.000000000000000, 3.0000000000000000, 0.0},
    {1.4814668382145526, 10.000000000000000, 4.0000000000000000, 0.0},
    {1.6310514712920277, 10.000000000000000, 5.0000000000000000, 0.0},
    {1.7943446637907288, 10.000000000000000, 6.0000000000000000, 0.0},
    {1.9724966112223774, 10.000000000000000, 7.0000000000000000, 0.0},
    {2.1667465045700540, 10.000000000000000, 8.0000000000000000, 0.0},
    {2.3784289194248460, 10.000000000000000, 9.0000000000000000, 0.0},
    {2.6089806329602614, 10.000000000000000, 10.000000000000000, 0.0},
};

const double tolerance_0010 = 5.0000000000000039e-13;

template<typename T1, unsigned int T2>
void
test(const confluent_hypergeometric_0_f_1_fixture<T1>(&fixtures)[T2], T1 tolerance) {
  const T1 epsilon = std::numeric_limits<T1>::epsilon();

  T1 maximum_absolute_difference = T1(-1);
  T1 maximum_absolute_fraction = T1(-1);

  auto error = 0;

  for (auto fixture: fixtures) {
    const T1 g = aten::native::special_functions::confluent_hypergeometric_0_f_1(fixture.c, fixture.x);

    if (std::isnan(g) && !error) {
      error = 1;
    }

    if (!std::isnan(g)) {
      const T1 f = fixture.f0;

      const auto difference = g - f;

      const auto absolute_difference = std::abs(difference);

      if (absolute_difference > maximum_absolute_difference) {
        maximum_absolute_difference = absolute_difference;
      }

      const auto abs_f = std::abs(f);
      const auto abs_g = std::abs(g);

      if (abs_f > T1(10) * epsilon && abs_g > T1(10) * epsilon) {
        const auto fraction = difference / f;

        const auto absolute_fraction = std::abs(fraction);

        if (absolute_fraction > maximum_absolute_fraction) {
          maximum_absolute_fraction = absolute_fraction;
        }
      }
    }
  }

  EXPECT_TRUE(!error && maximum_absolute_fraction < tolerance);
}

TEST(confluent_hypergeometric_0_f_1_test, GSL) {
  test(fixture_0001, tolerance_0001);
  test(fixture_0002, tolerance_0002);
  test(fixture_0003, tolerance_0003);
  test(fixture_0004, tolerance_0004);
  test(fixture_0005, tolerance_0005);
  test(fixture_0006, tolerance_0006);
  test(fixture_0007, tolerance_0007);
  test(fixture_0008, tolerance_0008);
  test(fixture_0009, tolerance_0009);
  test(fixture_0010, tolerance_0010);
}
